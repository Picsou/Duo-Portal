<html>
    
    <head>
        <script type="text/javascript" src="js/static.js"></script>
        <script type="text/javascript" src="js/crafty.js"></script>	
		<script type="text/javascript" src="js/network.js"></script>
		<script type="text/javascript" src="js/craftyComponents.js"></script>
        <link href="css/screen.css" type="text/css" rel="stylesheet" />
        <title>Collaborative 2D Portal Game</title>
        <style>
            body, html {
                margin: 0;
                padding: 0;
                font-family: Arial;
                font-size: 20px;
            }
            #cr-stage {
                border: 2px solid black;
                margin: 5px auto;
                color: white;
            }
        </style>
    </head>
    
    <body style="background: #222222 url(../images/bg-checker.png);">
        <audio controls>
            <source src="musics/Portal 2 Want You Gone.wav" type="audio/wav">
        </audio>

        <script type="text/javascript">
			var player2 = null;
			var player1 = null;
			var portal = null;

			var yellowPortal;
		    var bluePortal;

			var exitDoor;
		    var collisionParticle;
		    var mouse;

			var vertical_portal2 = "";
			var portal2_last;
			var portalDirectionLast;

			var level = 1;

			var width = 1245;
			var height = 600;

			function ready() {
				charSpeed = 6;
				gravity = 0.3;

				Crafty.init(width, height);

				Crafty.scene("loading", function () {
					remote.get_level(users['user'], function (arg){
						level = arg;

						Crafty.load(["./images/background.png"], function () {
						    Crafty.scene("Level" + level);
						});
					});

				    Crafty.background("#070");
				    Crafty.e("2D, DOM, Text").attr({
				        w: 100,
				        h: 20,
				        x: 150,
				        y: 120
				    })
				        .text("Loading")
				        .css({
				        "text-align": "center"
				    });
				});

				declareComponents();

				Crafty.scene("Level1", function () {
					initEntities();

					buildThickWall(0, 0, 1, 52, "active_wall", "horizontal");
					buildThickWall(0, 24, 1, 52, "active_wall", "horizontal");
					buildThickWall(0, 1, 19, 1, "active_wall", "vertical");
					buildThickWall(51, 1, 19, 1, "active_wall", "vertical");

					buildThickWall(20, 8, 17, 1, "inactive_wall", "vertical");
					buildThickWall(26, 8, 1, 10, "inactive_wall", "horizontal");
				});

				Crafty.scene("Level2", function () {
					initEntities();

					buildThickWall(0, 0, 1, 52, "active_wall", "horizontal");
					buildThickWall(0, 24, 1, 52, "active_wall", "horizontal");
					buildThickWall(0, 1, 19, 1, "active_wall", "vertical");
					buildThickWall(51, 1, 19, 1, "active_wall", "vertical");
				});

				Crafty.scene("Level3", function () {
					initEntities();

					buildThickWall(0, 0, 1, 52, "active_wall", "horizontal");
					buildThickWall(0, 24, 1, 52, "active_wall", "horizontal");
					buildThickWall(0, 1, 19, 1, "active_wall", "vertical");
					buildThickWall(51, 1, 19, 1, "active_wall", "vertical");

				    buildThickWall(5, 0, 20, 5, "inactive_wall", "vertical");
					buildThickWall(20, 0, 15, 2, "active_wall", "vertical");
					buildThickWall(30, 0, 15, 5, "inactive_wall", "vertical");
					buildThickWall(45, 0, 15, 1, "inactive_wall", "vertical");
				});

				Crafty.scene("loading");

				updateMessageSystem();

				trigger();
			}
        </script>
        <div id="cr-stage"></div>
        <div style="px;text-align:center;line-height:80px;">
            <textarea id="chat" readonly></textarea>
        </div>
        <div style="px;text-align:center;line-height:80px;">
            <input type="text" id="mes" class="textarea" onKeyDown="message()">
        </div>
        <div style="px;text-align:center;line-height:80px;">fps (<span id="val"></span>):
            <input type="range" id="fps" onChange="update_fps()" min="10" max="60" style="width:300px;" />
        </div>
    </body>

</html>
